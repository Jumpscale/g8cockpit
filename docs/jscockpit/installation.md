# Installation

There are two ways of install a new Cockpit:

- Using the **Cockpit Deployer Chatbot** on Telegram
- Using AtYourService


## Using Cockpit Deployer Chatbot

An instance of the **Cockpit Deployer Chatbot** is active as `Cockput` on Telegram.

You can also install your own instance by following the [Cockpit Deployer Chatbot installation instructions](../deployer_bot/installation.md).

Follow the [Cockpit Deployer Chatbot usage instructions](../deployer_bot/usage.md) in order to install your Cockpit.

Once your Cockpit is installed, you will get following information about your Cockpit:

- URL to reach the portal
- IP address and SSH command to connect to the virtual machine running your Cockpit
- SSH key to access the virtual machine


## Using AtYourService

If you have a system with JumpScale installed, you can also use AtYourService to create a new Cockpit.

- Create a AYS service repository:

```bash
mkdir -p /opt/code/ays_cockpit
mkdir -p /opt/code/ays_cockpit/blueprints
touch /opt/code/ays_cockpit/.ays
```

- Replace the values in this blueprint:

```yaml
g8client__main:
  g8.url: '{g8_url}'
  g8.login: '{g8_login}'
  g8.password: '{g8_password}'
  g8.account: '{g8_account}'

cockpit.g8__pilot:
  telegram.token: '{telegram_token}'
  cockpit.name: '{cockpit_name}'
  dns.sshkey: '{dns_sshkey}'
  dns.domain: '{dns_domain}'
  oauth.client_secret: '{oauth_secret}'
  oauth.client_id: '{oauth_id}'
  oauth.organization: '{oauth_organization}'
  oauth.jwt_key: '{oauth_jwtkey}'
```

Description of the values:
- **g8.url**: URL of the G8 where you want to deploy the cockpit, e.g. `be-scale-1.demo.greenitglobe.com`
- **g8.login**: Username of your user account on the G8
- **g8.password**: Password of your user account on the G8
- **g8.account**: Name of your (cloud) account on the G8; if not specified the username specified in g8.login will be used 
- **telegram.token**: API token from Telegram, as received from @botfather when you create a new bot
- **cockpit.name**: Can be anything
- **dns.domain**: 
  - Domain you want for your Cockpit, e.g. `mycockpit.barcelona.aydo.com`
  - If you don't use the auto DNS deployment then make sure your DNS name resolves to the Cockpit IP address
- **dns.sshkey**: Path to the sshkey of the DNS server;  
  - GIG employees: see https://gig.gitbooks.io/ovcdoc_internal/content/InternalIT/internal_it.html for more details about DNS infrastructure
  - Others: leave empty (could be this is not supported yet)
- **oauth.client_secret**: Client secret for your organization as generated by ItsYou.online
- **oauth.client_id**: Name of the organization as set in ItsYou.online, typically the company/organization for which you are setting up the Cockpit; as a user you are not necessairly owner or member of this organization
- **oauth.organization**: Name of the organization as set in ItsYou.online, to which you as a user belong to as a member or as an owner; can be the same organization as specified in client_id, but can also be different 
- **oauth.jwt_key**: ItsYou.online public key for JWT signing; see https://github.com/itsyouonline/identityserver/blob/master/docs/oauth2/jwt.md for more details
- **dind**: (true/false) Abreviation for "Docker in Docker"
- **staging**: (true/false) When set to true, no SSL certificates are required

- Copy the blueprint into the blueprints subdirectory:

```bash
cp bp.yml /opt/code/ays_cockpit/blueprints
```


```bash
ays blueprint
```

- Init and install the blueprint:

```bash
cd /opt/code/ays_cockpit
ays init
ays install
```

## Allow the Cockpit to push to your Github repository

The last thing you need to do is configure your Cockpit to create a deploy key on your GitHub repository where the AYS services will be saved.

To do that:
- Go on the **Settings** page of the GitHub repository specified during installation
- Click **Add deploy key** in **Deploy keys** tab
- Copy the content of the public key that you can find in the portal information page

![](Add-a-deply-key.png)