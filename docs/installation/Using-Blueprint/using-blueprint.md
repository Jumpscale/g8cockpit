## Installation using an AYS Blueprint

> Using the **Cockpit Deployer Chatbot** is the recommanded way to install a Cockpit. The option documented here is meant to be used only by Green IT Globe employees.

Below we discuss 4 steps:
- **Step 1**: Create an AYS service repository
- **Step 2**: Create the AYS blueprint
- **Step 3**: Execute the blueprint
- **Step 4**: Init and install the AYS service instances


### Step 1: Create an AYS service repository:

```bash
mkdir -p /opt/code/ays_cockpit
mkdir -p /opt/code/ays_cockpit/blueprints
touch /opt/code/ays_cockpit/.ays
```

### Step 2: Create the AYS blueprint

Replace the values in this blueprint:

```yaml
g8client__main:
  g8.url: '{g8-url}'
  g8.login: '{g8-login}'
  g8.password: '{g8-password}'
  g8.account: '{g8-account}'

cockpit.g8__pilot:
  g8.client: 'main'
  telegram.token: '{telegram-token}'
  cockpit.name: '{cockpit-name}'
  dns.sshkey: '{dns-sshkey-path}'
  dns.domain: '{dns-domain}'
  oauth.client_secret: '{oauth-client-secret}'
  oauth.client_id: '{oauth-client-id}'
  oauth.organization: 'itsyouonline'
  oauth.jwt_key: '{oauth-jwtkey}'
  dind: true
  staging: true
```


Description of the values:

- **g8.url**: URL of the G8 where you want to deploy the cockpit, e.g. `be-scale-1.demo.greenitglobe.com`
- **g8.login**: Username of your user account on the G8
- **g8.password**: Password of your user account on the G8
- **g8.account**: Name of your (cloud) account on the G8; if not specified the username specified in g8.login will be used 
- **telegram.token**: API token from Telegram, as received from @botfather when you create a new bot
- **cockpit.name**: Can be anything
- **dns.domain**: 
  - Domain you want for your Cockpit, e.g. `mycockpit.barcelona.aydo.com`
  - If you don't use the auto DNS deployment then make sure your DNS name resolves to the Cockpit IP address
- **dns.sshkey**: Path to the sshkey of the DNS server;  
  - GIG employees: see https://gig.gitbooks.io/ovcdoc_internal/content/InternalIT/internal_it.html for more details about DNS infrastructure
  - Others: leave empty (could be this is not supported yet)
- **oauth.client_secret**: Client secret for your organization as generated by ItsYou.online
- **oauth.client_id**: Name of the organization as set in ItsYou.online, typically the company/organization for which you are setting up the Cockpit; as a user you are not necessairly owner or member of this organization
- **oauth.organization**: Name of the organization as set in ItsYou.online, to which you as a user belong to as a member or as an owner; can be the same organization as specified in client_id, but can also be different 
- **oauth.jwt_key**: ItsYou.online public key for JWT signing; see https://github.com/itsyouonline/identityserver/blob/master/docs/oauth2/jwt.md for more details
- **dind**: (true/false) Abreviation for "Docker in Docker"
- **staging**: (true/false) When set to true, no SSL certificates are required


Copy the blueprint into the blueprints subdirectory:

```bash
cp bp.yml /opt/code/ays_cockpit/blueprints
```


### Step 3: Execute the blueprint

```bash
ays blueprint
```

### Step 4: Init and install the AYS service instances

```bash
cd /opt/code/ays_cockpit
ays init
ays install
```