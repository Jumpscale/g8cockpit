## Installation using an AYS Blueprint

> Using the **Cockpit Deployer Chatbot** is the recommanded way to install a Cockpit. The option documented here is meant to be used only by Green IT Globe employees.

Below we discuss 4 steps:
- **Step 1**: Create an AYS service repository
- **Step 2**: Create the AYS blueprint
- **Step 3**: Execute the blueprint
- **Step 4**: install the AYS service instances


### Step 1: Create an AYS service repository:

```bash
ays create_repo -p /path/to/my/repo -g http://github.com/account/ays_repo
```

### Step 2: Create the AYS blueprint

Go to [https://github.com/Jumpscale/jscockpit/tree/master/blueprint](https://github.com/Jumpscale/jscockpit/tree/master/blueprint) and copy the example blueprint into your local AYS blueprints repository.

```bash
curl https://raw.githubusercontent.com/Jumpscale/jscockpit/master/blueprint/ovc_blueprint.yaml > /path/to/my/repo/blueprints/cockpit.yaml
```



Depending on which patform you install the cockpit the begining of the blueprint can differe. The only importantn thing to remmeber is that the `cockpit` service always use another server of role `node` has parent.
This will indicate to the cockpit on wich node it needs to be installed. This bring flexibility during installation cause any service of role `node` can be used.
So you can install a cockpit on top of a VM using `node.ovc`, docker using `node.docker` or any or another node service you would create.

Description of the values for the cockpit service:

```yaml
sshkey__dns:
    key.path: '/root/.ssh/dns_rsa' # this needs to point to the a sshkey authorize on server of our dns infrastructure

# actually install the cockpit
cockpit__main:
   host_node: 'cockpit'
   dns.sshkey: 'dns'
   domain: 'mycockpit.aydo2.com'
   caddy.email: 'me@mail.com'
   caddy.staging: false

   oauth.organization: 'myOrg'
   oauth.client_id: 'myOrg'
   oauth.client_secret: 'replace_me'
   oauth.jwt_key: |
       -----BEGIN PUBLIC KEY-----
       MHYwEAYHKoZIzj0CAQYFK4EEACIDYgAES5X8XrfKdx9gYayFITc89wad4usrk0n2
       7MjiGYvqalizeSWTHEpnd7oea9IQ8T5oJjMVH5cc0H5tFSKilFFeh//wngxIyny6
       6+Vq5t5B0V0Ehy01+2ceEon2Y0XDkIKv
       -----END PUBLIC KEY-----

```
- **host_node**: Name of the node service you want to install the cockpit on.
- **dns.sshkey**: Name fo the sshkey servier that point to a sshkey authorize on our DNS infrastructure (dns[1,2,3].aydo.com)
- **domain**:
  - Domain you want for your Cockpit, e.g. `mycockpit.barcelona.aydo.com`
  - If you don't use the auto DNS deployment then make sure your DNS name resolves to the Cockpit IP address
- **caddy.email** : email use for [caddy](https://caddyserver.com/). This email will receive notification when the HTTPS certificate of the cockpit are about to expire. Caddy is supposed to renew them automaticly, but it's always good to double check that it actually happened.
- **oauth.organization**: Name of the organization as set in ItsYou.online, to which you as a user belong to as a member or as an owner; can be the same organization as specified in client_id, but can also be different
- **oauth.client_id**: Name of the organization as set in ItsYou.online, typically the company/organization for which you are setting up the Cockpit; as a user you are not necessairly owner or member of this organization
- **oauth.client_secret**: Client secret for your organization as generated by ItsYou.online
- **oauth.jwt_key**: ItsYou.online public key for JWT signing; see https://github.com/itsyouonline/identityserver/blob/master/docs/oauth2/jwt.md for more details
- **caddy.staging**: (true/false) enable stagging environement of Let's encrypt. Use this when doing test so you don't create real certificate. The number of certificate available for a domain is limited.


### Step 3: Execute the blueprint

```bash
ays blueprint
```


### Step 4: install the AYS service instances

```bash
ays run
```
